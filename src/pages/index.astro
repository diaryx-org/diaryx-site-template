---
import DiaryxLayout from "../layouts/DiaryxLayout.astro";
import { getEntry, getCollection, render } from "astro:content";

// Try common index entry names, then fall back to first entry
const indexSlug = import.meta.env.DIARYX_INDEX_ENTRY || "index";
let index = await getEntry("diaryx", indexSlug);

// Fallback: try "diaryx" as entry name
if (!index) {
  index = await getEntry("diaryx", "diaryx");
}

// Fallback: use the first entry in the collection
if (!index) {
  const allEntries = await getCollection("diaryx");
  if (allEntries.length > 0) {
    index = allEntries[0];
  }
}

if (!index) {
  throw new Error("No content entries found. Add markdown files to your content folder.");
}

const { Content, headings } = await render(index);
const frontmatter = index.data;
const trimFirstHeading =
  Array.isArray(headings) &&
  headings.length > 0 &&
  headings[0]?.depth === 1 &&
  headings[0]?.text.trim() === (frontmatter.title ?? "").trim();
---

<DiaryxLayout frontmatter={frontmatter} trimFirstHeading={trimFirstHeading}>
  <Content />
</DiaryxLayout>
